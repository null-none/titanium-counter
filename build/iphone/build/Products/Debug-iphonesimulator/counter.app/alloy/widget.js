var Alloy = require('/alloy');

// Hold a collection of widget objects instances. These
// objects are not the widgets themselves, but a set of
// auto-populated functions and properties that make
// developing widgets easier.
var widgets = {};

function ucfirst(text) {
  if (!text) {return text;}
  return text[0].toUpperCase() + text.substr(1);
}

module.exports = function (widgetId) {
  var self = this;

  // return existing widget object, if present
  if (widgets[widgetId]) {
    return widgets[widgetId];
  }

  // properties
  this.widgetId = widgetId;
  this.Collections = {};
  this.Models = {};
  this.Shared = {};

  // functions
  this.createController = function (name, args) {
    return new (require('/alloy/widgets/' + widgetId + '/controllers/' + name))(args);
  };
  this.createCollection = function (name, args) {
    return new (require('/alloy/widgets/' + widgetId + '/models/' + ucfirst(name)).Collection)(args);
  };
  this.createModel = function (name, args) {
    return new (require('/alloy/widgets/' + widgetId + '/models/' + ucfirst(name)).Model)(args);
  };
  this.createWidget = Alloy.createWidget; // just to be complete
  this.Collections.instance = function (name) {
    return self.Collections[name] || (self.Collections[name] = self.createCollection(name));
  };
  this.Models.instance = function (name) {
    return self.Models[name] || (self.Models[name] = self.createModel(name));
  };

  // add to widget object instances
  widgets[widgetId] = this;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndpZGdldC5qcyJdLCJuYW1lcyI6WyJBbGxveSIsInJlcXVpcmUiLCJ3aWRnZXRzIiwidWNmaXJzdCIsInRleHQiLCJ0b1VwcGVyQ2FzZSIsInN1YnN0ciIsIm1vZHVsZSIsImV4cG9ydHMiLCJ3aWRnZXRJZCIsInNlbGYiLCJDb2xsZWN0aW9ucyIsIk1vZGVscyIsIlNoYXJlZCIsImNyZWF0ZUNvbnRyb2xsZXIiLCJuYW1lIiwiYXJncyIsImNyZWF0ZUNvbGxlY3Rpb24iLCJDb2xsZWN0aW9uIiwiY3JlYXRlTW9kZWwiLCJNb2RlbCIsImNyZWF0ZVdpZGdldCIsImluc3RhbmNlIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFJQSxLQUFLLEdBQUdDLE9BQU8sQ0FBQyxRQUFELENBQW5COztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSUMsT0FBTyxHQUFHLEVBQWQ7O0FBRUEsU0FBU0MsT0FBVCxDQUFpQkMsSUFBakIsRUFBdUI7QUFDdEIsTUFBSSxDQUFDQSxJQUFMLEVBQVcsQ0FBRSxPQUFPQSxJQUFQLENBQWM7QUFDM0IsU0FBT0EsSUFBSSxDQUFDLENBQUQsQ0FBSixDQUFRQyxXQUFSLEtBQXdCRCxJQUFJLENBQUNFLE1BQUwsQ0FBWSxDQUFaLENBQS9CO0FBQ0E7O0FBRURDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQixVQUFTQyxRQUFULEVBQW1CO0FBQ25DLE1BQUlDLElBQUksR0FBRyxJQUFYOztBQUVBO0FBQ0EsTUFBSVIsT0FBTyxDQUFDTyxRQUFELENBQVgsRUFBdUI7QUFDdEIsV0FBT1AsT0FBTyxDQUFDTyxRQUFELENBQWQ7QUFDQTs7QUFFRDtBQUNBLE9BQUtBLFFBQUwsR0FBZ0JBLFFBQWhCO0FBQ0EsT0FBS0UsV0FBTCxHQUFtQixFQUFuQjtBQUNBLE9BQUtDLE1BQUwsR0FBYyxFQUFkO0FBQ0EsT0FBS0MsTUFBTCxHQUFjLEVBQWQ7O0FBRUE7QUFDQSxPQUFLQyxnQkFBTCxHQUF3QixVQUFTQyxJQUFULEVBQWVDLElBQWYsRUFBcUI7QUFDNUMsV0FBTyxLQUFLZixPQUFPLENBQUMsb0JBQW9CUSxRQUFwQixHQUErQixlQUEvQixHQUFpRE0sSUFBbEQsQ0FBWixFQUFxRUMsSUFBckUsQ0FBUDtBQUNBLEdBRkQ7QUFHQSxPQUFLQyxnQkFBTCxHQUF3QixVQUFTRixJQUFULEVBQWVDLElBQWYsRUFBcUI7QUFDNUMsV0FBTyxLQUFLZixPQUFPLENBQUMsb0JBQW9CUSxRQUFwQixHQUErQixVQUEvQixHQUE0Q04sT0FBTyxDQUFDWSxJQUFELENBQXBELENBQVAsQ0FBbUVHLFVBQXhFLEVBQW9GRixJQUFwRixDQUFQO0FBQ0EsR0FGRDtBQUdBLE9BQUtHLFdBQUwsR0FBbUIsVUFBU0osSUFBVCxFQUFlQyxJQUFmLEVBQXFCO0FBQ3ZDLFdBQU8sS0FBS2YsT0FBTyxDQUFDLG9CQUFvQlEsUUFBcEIsR0FBK0IsVUFBL0IsR0FBNENOLE9BQU8sQ0FBQ1ksSUFBRCxDQUFwRCxDQUFQLENBQW1FSyxLQUF4RSxFQUErRUosSUFBL0UsQ0FBUDtBQUNBLEdBRkQ7QUFHQSxPQUFLSyxZQUFMLEdBQW9CckIsS0FBSyxDQUFDcUIsWUFBMUIsQ0F4Qm1DLENBd0JLO0FBQ3hDLE9BQUtWLFdBQUwsQ0FBaUJXLFFBQWpCLEdBQTRCLFVBQVNQLElBQVQsRUFBZTtBQUMxQyxXQUFPTCxJQUFJLENBQUNDLFdBQUwsQ0FBaUJJLElBQWpCLE1BQTJCTCxJQUFJLENBQUNDLFdBQUwsQ0FBaUJJLElBQWpCLElBQXlCTCxJQUFJLENBQUNPLGdCQUFMLENBQXNCRixJQUF0QixDQUFwRCxDQUFQO0FBQ0EsR0FGRDtBQUdBLE9BQUtILE1BQUwsQ0FBWVUsUUFBWixHQUF1QixVQUFTUCxJQUFULEVBQWU7QUFDckMsV0FBT0wsSUFBSSxDQUFDRSxNQUFMLENBQVlHLElBQVosTUFBc0JMLElBQUksQ0FBQ0UsTUFBTCxDQUFZRyxJQUFaLElBQW9CTCxJQUFJLENBQUNTLFdBQUwsQ0FBaUJKLElBQWpCLENBQTFDLENBQVA7QUFDQSxHQUZEOztBQUlBO0FBQ0FiLEVBQUFBLE9BQU8sQ0FBQ08sUUFBRCxDQUFQLEdBQW9CLElBQXBCO0FBQ0EsQ0FsQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgQWxsb3kgPSByZXF1aXJlKCcvYWxsb3knKTtcblxuLy8gSG9sZCBhIGNvbGxlY3Rpb24gb2Ygd2lkZ2V0IG9iamVjdHMgaW5zdGFuY2VzLiBUaGVzZVxuLy8gb2JqZWN0cyBhcmUgbm90IHRoZSB3aWRnZXRzIHRoZW1zZWx2ZXMsIGJ1dCBhIHNldCBvZlxuLy8gYXV0by1wb3B1bGF0ZWQgZnVuY3Rpb25zIGFuZCBwcm9wZXJ0aWVzIHRoYXQgbWFrZVxuLy8gZGV2ZWxvcGluZyB3aWRnZXRzIGVhc2llci5cbnZhciB3aWRnZXRzID0ge307XG5cbmZ1bmN0aW9uIHVjZmlyc3QodGV4dCkge1xuXHRpZiAoIXRleHQpIHsgcmV0dXJuIHRleHQ7IH1cblx0cmV0dXJuIHRleHRbMF0udG9VcHBlckNhc2UoKSArIHRleHQuc3Vic3RyKDEpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHdpZGdldElkKSB7XG5cdHZhciBzZWxmID0gdGhpcztcblxuXHQvLyByZXR1cm4gZXhpc3Rpbmcgd2lkZ2V0IG9iamVjdCwgaWYgcHJlc2VudFxuXHRpZiAod2lkZ2V0c1t3aWRnZXRJZF0pIHtcblx0XHRyZXR1cm4gd2lkZ2V0c1t3aWRnZXRJZF07XG5cdH1cblxuXHQvLyBwcm9wZXJ0aWVzXG5cdHRoaXMud2lkZ2V0SWQgPSB3aWRnZXRJZDtcblx0dGhpcy5Db2xsZWN0aW9ucyA9IHt9O1xuXHR0aGlzLk1vZGVscyA9IHt9O1xuXHR0aGlzLlNoYXJlZCA9IHt9O1xuXG5cdC8vIGZ1bmN0aW9uc1xuXHR0aGlzLmNyZWF0ZUNvbnRyb2xsZXIgPSBmdW5jdGlvbihuYW1lLCBhcmdzKSB7XG5cdFx0cmV0dXJuIG5ldyAocmVxdWlyZSgnL2FsbG95L3dpZGdldHMvJyArIHdpZGdldElkICsgJy9jb250cm9sbGVycy8nICsgbmFtZSkpKGFyZ3MpO1xuXHR9O1xuXHR0aGlzLmNyZWF0ZUNvbGxlY3Rpb24gPSBmdW5jdGlvbihuYW1lLCBhcmdzKSB7XG5cdFx0cmV0dXJuIG5ldyAocmVxdWlyZSgnL2FsbG95L3dpZGdldHMvJyArIHdpZGdldElkICsgJy9tb2RlbHMvJyArIHVjZmlyc3QobmFtZSkpLkNvbGxlY3Rpb24pKGFyZ3MpO1xuXHR9O1xuXHR0aGlzLmNyZWF0ZU1vZGVsID0gZnVuY3Rpb24obmFtZSwgYXJncykge1xuXHRcdHJldHVybiBuZXcgKHJlcXVpcmUoJy9hbGxveS93aWRnZXRzLycgKyB3aWRnZXRJZCArICcvbW9kZWxzLycgKyB1Y2ZpcnN0KG5hbWUpKS5Nb2RlbCkoYXJncyk7XG5cdH07XG5cdHRoaXMuY3JlYXRlV2lkZ2V0ID0gQWxsb3kuY3JlYXRlV2lkZ2V0OyAvLyBqdXN0IHRvIGJlIGNvbXBsZXRlXG5cdHRoaXMuQ29sbGVjdGlvbnMuaW5zdGFuY2UgPSBmdW5jdGlvbihuYW1lKSB7XG5cdFx0cmV0dXJuIHNlbGYuQ29sbGVjdGlvbnNbbmFtZV0gfHwgKHNlbGYuQ29sbGVjdGlvbnNbbmFtZV0gPSBzZWxmLmNyZWF0ZUNvbGxlY3Rpb24obmFtZSkpO1xuXHR9O1xuXHR0aGlzLk1vZGVscy5pbnN0YW5jZSA9IGZ1bmN0aW9uKG5hbWUpIHtcblx0XHRyZXR1cm4gc2VsZi5Nb2RlbHNbbmFtZV0gfHwgKHNlbGYuTW9kZWxzW25hbWVdID0gc2VsZi5jcmVhdGVNb2RlbChuYW1lKSk7XG5cdH07XG5cblx0Ly8gYWRkIHRvIHdpZGdldCBvYmplY3QgaW5zdGFuY2VzXG5cdHdpZGdldHNbd2lkZ2V0SWRdID0gdGhpcztcbn07Il0sInNvdXJjZVJvb3QiOiIvVXNlcnMvZG1pdHJpeS9Xb3JrL3RpdGFuaXVtL2NvdW50ZXIvUmVzb3VyY2VzL2lwaG9uZS9hbGxveSJ9
